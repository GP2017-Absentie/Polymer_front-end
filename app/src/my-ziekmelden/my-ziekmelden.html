
<!----------------------------------------------------IMPORTS---------------------------------------------------------->
<link rel="import" href="../../bower_components/polymer/polymer.html" xmlns="">
<link rel="import" href="../../bower_components/paper-styles/typography.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/iron-icons/social-icons.html">
<link rel="import" href="../../bower_components/brainy-table/brainy-table.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">

<dom-module id="my-ziekmelden">
    <template>
<!----------------------------------------------------STYLE------------------------------------------------------------>
        <style>
            :host {
                display: block;
            }
            :root {
                --paper-input-container-focus-color: #1a9fd9; /* kind of blue */
            }
            span {
                @apply(--paper-font-body1);
            }
            .toast-button {
                text-transform: none;
                color: white; /* white tekst */
                background: #1a9fd9; /* kind of blue */
                --paper-button-ink-color: #00567B; /* kind of dark blue */
            }
            p {
                font-size: 15px;
            }
            #icon {
                margin-right: 5px;
            }
            .padding {
                padding-top: 15px;
                padding-bottom: 15px;
            }
            paper-button.indigo {
                background-color: #1a9fd9;
                color: white;
                float: right;
                margin-top: 15px;
                --paper-button-raised-keyboard-focus: {
                    background-color: var(--paper-pink-a200) !important;
                    color: white !important;
                }}
            .clear {
                clear: both;
            }

            #goed {
                background-color: #a9ff8c;
                display: none;
                border-radius: 0 0 8px 8px;
                margin: 0 1px;
            }
            #fout {
                background-color: rgba(255, 83, 66, 0.58);
                display: none;
                border-radius: 0 0 8px 8px;
                margin: 0 1px;
            }

        </style>
<!----------------------------------------------------HTML------------------------------------------------------------->
        <!--FOUTMELDING, ILLEGAAL OP PAGINA-->
        <paper-toast
                id="toast_invalid_aanroep"
                duration="0"
                text="U hebt dit scherm op een illegale manier geactiveerd. U wordt verwezen naar de home page!">
            <paper-button on-click="_toast_clicked" class="toast-button">Sluiten</paper-button>
        </paper-toast>

        <!--PAGINA HEADER-->
        <h2>Ziek Melden</h2>
        <p>Welkom [[c_user.name]],<br>
           Hier kan je je ziek melden voor vandaag ([[c_systeemdatumlokaal]])</p>

        <!--NAAM VAN GEBRUIKER, READONLY-->
        <paper-input label="Gebruiker" readonly value="[[c_user.name]]">
            <iron-icon id="icon" icon="social:person" prefix></iron-icon>
        </paper-input>

        <!--DATUM VAN "VANDAAG", READONLY-->
        <paper-input label="Datum" readonly value="[[c_systeemdatumlokaal]]">
            <iron-icon id="icon" icon="icons:date-range" prefix></iron-icon>
        </paper-input>

        <!--TABELUITLEG, VERSCHILLEND VOOR DOCENT EN STUDENT-->
        <!--IF ROL IS DOCENT-->
        <template is="dom-if" if="[[_are_strings_equal(c_user.rol, 'docent')]]">
            <section class="padding">Dit zijn de lessen die je vandaag zal missen door je afwezigheid.
                                     De studenten worden automatisch op de hoogste gesteld van je afwezigheid
            </section>
        </template>
        <!--IF ROL IS STUDENT-->
        <template is="dom-if" if="[[_are_strings_equal(c_user.rol, 'student')]]">
            <section class="padding">Dit zijn de vakken die je vandaag zal missen door je afwezigheid.
                                     Je moet zelf met de docent een oplossing zoeken voor eventuele
                                     gemiste verplichtingen
            </section>
        </template>

        <!--TABEL MET ALLE LESSEN VAN "VANDAAG"-->
        <brainy-table id="table" items="[[vakken]]" page-size="5">
            <brainy-table-column name="Cursuscode" width="45px">
                <template>[[item.code]]</template>
            </brainy-table-column>
            <brainy-table-column name="Starttijd" width="45px">
                <template>[[item.start]]</template>
            </brainy-table-column>
            <brainy-table-column name="Eindtijd" width="45px">
                <template>[[item.eind]]</template>
            </brainy-table-column>
            <template is="dom-if" if="[[_are_strings_equal(c_user.rol, 'student')]]">
                <brainy-table-column name="Docent" width="95px">
                    <template>[[item.docent]]</template>
                </brainy-table-column>
            </template>
            <template is="dom-if" if="[[_are_strings_equal(c_user.rol, 'docent')]]">
                <brainy-table-column name="Klas" width="95px">
                    <template>[[item.klas]]</template>
                </brainy-table-column>
            </template>

        </brainy-table>

        <!--MESSAGES NA INZENDEN ZIEKMELDING, GOED OF FOUT-->
        <div id="goed" class="padding">Je bent ziek gemeld! Veel beterschap</div>
        <div id="fout" class="padding">Er is helaas iets mis gegaan. Probeer het nog een keer of neem contact op met de Hogeschool Utrecht.</div>

        <!--BUTTON OM ZIEKMELDING IN TE ZENDEN-->
        <paper-button raised on-click="_meld_ziek" class="indigo">Ziek Melden</paper-button>
        <br class="clear">

        <iron-ajax
                id="ajax_vakken_ophalen"
                method="POST"
                url="/vakkenophalen"
                handle-as="json"
                on-response="_vakken_ophalen_handler">
        </iron-ajax>

        <iron-ajax
                id="ajax_ziek_melden"
                method="POST"
                url="/ziekmelden"
                handle-as="json"
                on-response="_meld_ziek_handler">
        </iron-ajax>



    </template>

    <script>
        (function() {
            'use strict';
            /* _xxxx private              : geen external data binding      - geen notify
             _c_xx private constant     : geen external binding, constant - geen notify
             c_xx  public constant      : one way external databinding [[c_xx]] - geen notify nodig
             xxxx  public               : two way external databinding {{xxxx}} - notify nodig
             */
            Polymer({
                is: 'my-ziekmelden',

                properties: {
                    c_user: {
                        type: Object
                    },
                    c_systeemdatumlokaal: {
                        type: String
                    },
                    c_systeemdatumstandaard: {
                        type: String
                    },
                    c_visible: {
                        type: Boolean,                                      /* true when element is the active visible item */
                        value: false,
                        observer: '_vakken_ophalen'                         /* wordt ook aangeroepen bijwisseling van true naar false.
                         regel in de functie dat er niets gebeurd
                         als c_visible false is */
                    },
                    vakken: {
                        type: Array
                    }
                },

                _vakken_ophalen: function (user, date) {

                    if (this.c_visible) {
                        var ajax = this.$.ajax_vakken_ophalen;
                        ajax.contentType="application/json";
                        ajax.body={
                            id: this.c_user.id,
                            date: this.c_systeemdatumstandaard
                        };
                        ajax.generateRequest();
                    }
                    this._initializing();
//                    var vakken = [
//                            {code: "AUI", start: "8:30", eind: "10:30", docent: "Peter Schuler", klas: "V1D"},
//                            {code: "OODC", start: "13:00", eind: "15:00", docent: "Adriaan Bakker", klas: "V1A"},
//                            {code: "GP", start: "17:00", eind: "19:00", docent: "Martijn Jansen", klas: "V1C"}
//                        ];
//                    return vakken;
                },

                _vakken_ophalen_handler: function (request) {
                    this.vakken = request.detail.response.vakken;
                },

                _meld_ziek: function () {
                    console.log(this.c_systeemdatumlokaal);
                    console.log(this.c_systeemdatumstandaard);
                    var ajax = this.$.ajax_ziek_melden;
                    ajax.contentType="application/json";
                    ajax.body={
                        id: this.c_user.id,
                        date: this.c_systeemdatumstandaard
                    };
                    ajax.generateRequest();
                    this.$.fout.style.display = "block";
                },

                _meld_ziek_handler: function (request) {
                    //response krijgen dat het goed gegaan is of niet. Indien goed:

                },

                _go_home: function() {
                    var lApp = document.querySelector('my-app');  //het polymer element <my-app>
                    var lAppRouter = lApp.$.approuter;            // het html-element <app-route> met id=approuter
                    lAppRouter.data={page: ""};                   // vul het data attribute met de homepage url
                                                                  // door de two way binding in <app-route> en <app-location>
                                                                  // zal ook de url echt wijzigen
                },

                _are_strings_equal: function(p_str1, p_str2) {
                    if(p_str2 === 'both'&& p_str1 !== 'undefined')
                        return true;
                    //console.log("_are_strings_equal: " + p_str1 + " met: " + p_str2);
                    return (p_str1===p_str2);
                },

                _initializing : function() {
                    if (this.c_visible) {                                 // zodra zichtbaar geworden moet er wat worden gedaan
                        if (this.c_user.rol==="student" || this.c_user.rol==="docent") {                        // voor studenten
                            //doe iets
                        } else {                                            // na handmatige url wijziging zonder login
                            var lToast = this.$.toast_invalid_aanroep;        // meldt ongeldige aanroep
                            lToast.open();                                    /* het sluiten van deze error verwijst  */
                            /* terug naar home page */
                        }
                    }
                    this.$.fout.style.display = "none";
                    this.$.goed.style.display = "none";
                },

                _toast_clicked: function(e) {
                    var lToast = this.$.toast_invalid_aanroep;        // meldt ongeldige aanroep
                    lToast.toggle();
                    this._go_home();
                }

            });
        })();
    </script>
</dom-module>
